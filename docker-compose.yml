version: '3.8'

services:
  selfplay:
    build: .
    image: checker_ml:latest
    container_name: selfplay_training
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - TF_FORCE_GPU_ALLOW_GROWTH=true
    volumes:
      - ./sandbox:/app/sandbox
    working_dir: /app
    command: python -m sandbox._3moku.models.alpha_zero.self_play

  train:
    build: .
    image: checker_ml:latest
    container_name: train_network
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - TF_FORCE_GPU_ALLOW_GROWTH=true
    volumes:
      - ./sandbox:/app/sandbox
    working_dir: /app
    command: python -m sandbox._3moku.models.alpha_zero.train_network

  evaluate:
    build: .
    image: checker_ml:latest
    container_name: evaluate_network
    runtime: nvidia
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - TF_FORCE_GPU_ALLOW_GROWTH=true
    volumes:
      - ./sandbox:/app/sandbox
    working_dir: /app
    command: python -m sandbox._3moku.models.alpha_zero.evaluate_network

